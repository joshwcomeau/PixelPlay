{"version":3,"sources":["game/answer_with_numbers.directive.js","game/fetch_cities.service.js","game/fetch_photos.service.js","game/game.ctrl.js","game/game_manager.service.js","global/global.ctrl.js","components/game/game.module.js","components/score/score.module.js","app.routes.js","app.js","score/score.service.js","user/user.service.js","services/preloader.service.js","services/reverse_geocoder.service.js"],"names":[],"mappings":"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","file":"main.min.js","sourcesContent":["function answerWithNumbers($document, GameManager) {\n  return {\n    restrict: 'A',\n    link: function() {\n      $document.bind('keyup', function(e) {\n        if ( e.which === 49 ) {\n          $(\"#answer-1\").click();\n          $(\"#answer-1 .number-label\").removeAttr(\"style\");\n        } else if ( e.which === 50 ) {\n          $(\"#answer-2\").click();\n          $(\"#answer-2 .number-label\").removeAttr(\"style\");          \n        } else if ( e.which === 51 ) {\n          $(\"#answer-3\").click();\n          $(\"#answer-3 .number-label\").removeAttr(\"style\");\n        }\n      });\n\n      $document.bind('keydown', function(e) {\n        if ( e.which === 49 ) {\n          $(\"#answer-1 .number-label\").css({ background: '#347b8e'});\n        } else if ( e.which === 50 ) {\n          $(\"#answer-2 .number-label\").css({ background: '#347b8e'});\n        } else if ( e.which === 51 ) {\n          $(\"#answer-3 .number-label\").css({ background: '#347b8e'});\n        }\n      });\n    }\n  };\n}\n\n\nangular.module('pixelPlay').directive('answerWithNumbers', ['$document', 'GameManager', answerWithNumbers]);","function FetchCities($resource) {\n  return $resource('/api/cities');\n}\n\nangular.module('pixelPlay.game').factory(\"FetchCities\", [\"$resource\", FetchCities]);","function FetchPhotos($q) {\n  return {\n    allPhotos:      [],\n    filteredPhotos: [],\n    maxSizePhotos:  [],\n\n    query: function(givenOpts) {\n      console.log(\"Querying\");\n      var \n      deferred = $q.defer(),\n      defaultOpts = {\n        feature:    'fresh_today',\n        only:       'Urban Exploration',\n        image_size: 5,\n        rpp:        100\n      },\n      opts = _.merge(defaultOpts, givenOpts);\n      _this    = this;\n\n      _500px.api('/photos', opts, function (response) {\n        if (response.success) {\n          _this.allPhotos      = response.data.photos;\n          _this.filteredPhotos = _this.appropriateForGame(response.data.photos);\n          _this.maxSizePhotos  = _this.getMaxSize(_this.filteredPhotos);\n\n          deferred.resolve({\n            success: true\n          });\n        } else {\n          deferred.reject({\n            success:  false,\n            status:   response.status,\n            message:  response.error_message\n          });\n        }\n      });\n\n      return deferred.promise;\n    },\n\n    // We need to strip out the photos that aren't well suited for our game.\n    // Needs to have location coordinates, at least 1200px wide, and landscape orientation.\n    appropriateForGame: function(photos) {\n      return _.filter(photos, function(photo) {\n        return (\n          photo.latitude !== null && \n          photo.longitude !== null &&\n          photo.width >= 1200 &&\n          photo.width > photo.height &&\n          photo.width <= (photo.height * 2)\n        );\n      });\n    },\n\n    getMaxSize: function(photos) {\n      console.log(\"maxSize\");\n      return _.map(photos, function(photo) {\n        photo.image_url = photo.image_url.substr(0, photo.image_url.length-5) + \"2048.jpg\";\n        return photo;\n      });\n    }\n  };\n}\n\nangular.module('pixelPlay.game').factory(\"FetchPhotos\", [\"$q\", FetchPhotos]);","function GameController($scope, GameManager, FetchPhotos, bogusAnswers) {\n  this.manager = GameManager;\n  GameManager.photos  = FetchPhotos.maxSizePhotos;\n  GameManager.countriesAndCities  = bogusAnswers;\n\n  GameManager.initialize();\n  \n}\n\n\n// Called in app.routes.js before the view is rendered.\nGameController.resolve = {\n  getPhotos: ['FetchPhotos', function(FetchPhotos) {\n    return FetchPhotos.query();\n  }],\n  bogusAnswers: ['FetchCities', function(FetchCities) {\n    return FetchCities.query().$promise;\n  }]\n};\n\n\nGameController.$inject = ['$scope', 'GameManager', 'FetchPhotos', 'bogusAnswers'];\nangular.module('pixelPlay.game').controller('GameController', ['$scope', 'GameManager', 'FetchPhotos', 'bogusAnswers', GameController]);","function GameManager($interval, $timeout, $q, FetchPhotos, FetchCities, Preloader, ReverseGeocoder) { \n  var manager = this;\n\n  this.initialize = function() {\n    // Provided from GameController\n    // this.countriesAndCities;\n    // this.photos;\n\n\n    this.score = 0;\n    this.combo = 0;\n\n    console.log(this.photos);\n\n    this.loadedPhotos     = [];\n    this.currentPhoto     = null;\n    this.currentAnswers   = null;\n    this.currentQuestion  = 0;\n    this.chosenAnswer     = null;\n    this.page             = 1;\n\n    this.resultsSplash    = null;\n\n    this.loading          = false;\n    this.loadPercent      = 0;\n\n    // Possible states are 'initial', 'waiting', 'running', 'finished', 'error'\n    this.state = 'initial';\n\n\n\n    // First order of business: Start preloading photos and locations!\n    this.preloadQuestions(3);\n\n  };\n\n  this.startGame = function() {\n    this.state = 'running';\n  };\n\n  // Our images are loaded and we're ready to go.\n  // Set it up so that the user can click 'start'.\n  this.setupGame = function() {\n    this.currentPhoto   = this.loadedPhotos.shift();\n    this.currentAnswers = this.buildAnswers();\n    this.state          = 'waiting';\n  };\n\n  this.preloadQuestions = function(iterations) {\n    var index             = 0,\n        currentIteration  = 0,\n        pauseLength       = 350,\n        question, startTime, endTime, iterationLength, timeLeftToWait;\n\n    manager.loading = true;\n    iterations = iterations || 1;\n\n    preloadQuestion();\n\n\n\n    function preloadQuestion() {\n      startTime = new Date().getTime();\n\n      question = manager.photos[0];\n      console.log(\"PRELOADING \", question);\n\n      $q.all({\n        getImage:    Preloader.preloadImages([question]), \n        getLocation: ReverseGeocoder.getLocation(question)\n      }).then(function(results) {\n        console.log(results);\n\n        question.location = results.getLocation.location;\n        manager.loadedPhotos.push(question);\n\n        manager.photos.shift();\n\n        \n\n        currentIteration++;\n        manager.loadPercent = (currentIteration / iterations) * 100;\n\n\n        // Alright, here's the magic.\n        // If this is our final iteration, currentIteration should == iterations.\n        // IF that's true, all of our preloading is done.\n        // Otherwise, we'll need to figure out how much time we have left to wait,\n        // set a timeout, and re-invoke this function.\n\n        if ( currentIteration === iterations ) {\n          manager.loading = false;\n\n          // Is this our initial load? If so, set up the game.\n          if ( manager.state === 'initial' ) {\n            manager.setupGame();\n          }\n\n        } else {\n          endTime = new Date().getTime();\n          iterationLength = endTime - startTime;\n          if ( iterationLength < pauseLength ) {\n            timeLeftToWait = pauseLength - iterationLength;\n            $timeout(preloadQuestion, timeLeftToWait);\n          } else {\n            preloadQuestion();\n          }\n        }\n      }, function(results) {\n        // Something went wrong, so we want to skip this question and load a new one.\n        manager.photos.shift();\n\n        endTime = new Date().getTime();\n        iterationLength = endTime - startTime;\n        if ( iterationLength < pauseLength ) {\n          timeLeftToWait = pauseLength - iterationLength;\n          console.log(\"I should wait \", timeLeftToWait);\n          $timeout(preloadQuestion, timeLeftToWait);\n        } else {\n          console.log(\"this iteration has taken \", iterationLength, \", which is longer than \", pauseLength);\n          // preloadQuestion();\n        }\n      });\n    }\n  };\n\n  this.submitAnswer = function(ans) {\n    if ( this.resultsSplash === null ) {\n      this.chosenAnswer = ans;\n      if ( this.currentPhoto.location.city === ans.city ) {\n        // They got it right!\n        this.score++;\n        this.combo++;\n        this.resultsSplash = true;\n      } else {\n        this.resultsSplash = false;\n        this.combo = 0;\n      }\n\n      // preload another question.\n      this.preloadQuestions();\n\n      // Fetch more questions from 500px, if necessary (or available)\n      if (this.photos.length < 10) {\n        this.page++;\n        FetchPhotos.query({page: this.page})\n        .then(function(result) {\n          _.forEach(FetchPhotos.filteredPhotos, function(photo) {\n            manager.photos.push(photo);\n          });\n        });\n      }\n\n      $timeout(function() {\n        manager.currentPhoto = manager.loadedPhotos.shift();  \n      }, 150);\n    }\n\n  };  \n\n  this.goToNextQuestion = function() {\n    this.chosenAnswer = null;\n    this.currentQuestion++;\n    this.currentAnswers = this.buildAnswers();\n\n    this.resultsSplash  = null;\n  };\n\n  this.buildAnswers = function() {\n    var pluckedCity1 = this.pickRandomCity(),\n        pluckedCity2 = pluckedCity1;\n\n    this.rightAnswer = this.currentPhoto.location;\n\n    while( pluckedCity1.city === pluckedCity2.city ) {\n      pluckedCity2 = this.pickRandomCity();\n    }\n\n    return _.shuffle([this.rightAnswer, pluckedCity1, pluckedCity2]);\n  };\n\n  this.pickRandomCity = function() {\n    var ans, country, city;\n    ans = _.sample(this.countriesAndCities);\n\n    country = ans.country;\n    city    = _.sample(ans.cities);\n\n    return {\n      country: country,\n      city:    city\n    };\n  };\n\n\n}\n\n\nangular.module('pixelPlay.game').service('GameManager', ['$interval', '$timeout', '$q', 'FetchPhotos', 'FetchCities', 'Preloader', 'ReverseGeocoder', GameManager]);\n","function GlobalController($scope, User, GameManager) {\n  var global = this;\n\n  global.manager = GameManager;\n\n  global.currentUser = null;\n  global.userService = User;\n\n  $scope.$on(\"userAuthenticated\", function(e, data) {\n    $scope.$apply(function() {\n      global.currentUser = data;\n      console.log(data);\n    });\n  });\n}\n\n\nGlobalController.$inject = ['$scope', 'User', 'GameManager'];\nangular.module('pixelPlay').controller('GlobalController', ['$scope', 'User', 'GameManager', GlobalController]);","angular.module(\"pixelPlay.game\", []);","angular.module('pixelPlay.score', []);","angular.module('appRoutes', []).config(['$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {\n  $routeProvider\n    .when('/', {\n      templateUrl:  '/components/dashboard/dashboard.index.html'\n    })\n\n    // GAME ===================================================================\n    // GET :index\n    .when('/game', {\n      templateUrl:  '/components/game/game.index.html',\n      controller:   'GameController',\n      controllerAs: 'game',\n      resolve:      GameController.resolve\n    });\n\n\n    $locationProvider.html5Mode(true);\n}]);","angular\n  .module('pixelPlay', ['ngAnimate', 'ngRoute', 'ngResource', 'appRoutes', 'pixelPlay.game', 'pixelPlay.score'])\n  .run(['User', '$rootScope', function(User, $rootScope) {\n    _500px.init({\n      sdk_key: '1e6cd00470800d39b07106a70a650cdf88277901'\n    });\n\n    console.log(\"500px initialized\");\n\n    _500px.getAuthorizationStatus(User.updateUser);\n\n}]);","angular.module('pixelPlay.score').factory(\"Score\", [\"$resource\", function($resource) {\n  return $resource('/api/scores/:id');\n}]);","angular.module('pixelPlay').service('User', ['$rootScope', 'Score', function($rootScope, Score) {\n  var user = this;\n\n  user.currentUser = null;\n  user.data        = null;\n\n\n  user.login = function() {\n    _500px.login(user.updateUser);\n  };\n\n  user.logout = function() {\n    _500px.logout(user.updateUser);\n  };\n\n  // This is passed in as the callback to 500px's getAuthorizationStatus().\n  user.updateUser = function(res) {\n    if ( res === 'authorized' ) {\n      // Cool, we've got their permission. Let's get their user data.\n      _500px.api('/users', function (response) {\n        console.log(response);\n        user.currentUser = response.data.user;\n        user.data        = response;\n        $rootScope.$broadcast('userAuthenticated', response.data.user);\n      });\n    } else {\n      console.log(\"updateUser is logging out\");\n      user.currentUser = user.data = null;\n    }\n  };\n}]);","// Originally written by Ben Nadel (http://www.bennadel.com/blog/2597-preloading-images-in-angularjs-with-promises.htm)\n// Modified by Joshua Comeau\n\nangular.module('pixelPlay')\n.factory(\"Preloader\", ['$q', '$rootScope', function( $q, $rootScope ) {\n\n  // I manage the preloading of image objects. Accepts an array of image URLs.\n  function Preloader( imageLocations ) {\n\n    // Because I'm passing in an array of objects, we need to extract\n    // just the strings for image locations.\n    this.imageLocations = _.map(imageLocations, function(img) {\n      return img.image_url;\n    });\n\n    // As the images load, we'll need to keep track of the load/error\n    // counts when announing the progress on the loading.\n    this.imageCount = this.imageLocations.length;\n    this.loadCount = 0;\n    this.errorCount = 0;\n\n    // I am the possible states that the preloader can be in.\n    this.states = {\n      PENDING: 1,\n      LOADING: 2,\n      RESOLVED: 3,\n      REJECTED: 4\n    };\n\n    // I keep track of the current state of the preloader.\n    this.state = this.states.PENDING;\n\n    // When loading the images, a promise will be returned to indicate\n    // when the loading has completed (and / or progressed).\n    this.deferred = $q.defer();\n    this.promise = this.deferred.promise;\n\n  }\n\n\n  // ---\n  // STATIC METHODS.\n  // ---\n\n\n  // I reload the given images [Array] and return a promise. The promise\n  // will be resolved with the array of image locations.\n  Preloader.preloadImages = function( imageLocations ) {\n\n    var preloader = new Preloader( imageLocations );\n\n    return( preloader.load() );\n\n  };\n\n\n  // ---\n  // INSTANCE METHODS.\n  // ---\n\n\n  Preloader.prototype = {\n\n    // Best practice for \"instanceof\" operator.\n    constructor: Preloader,\n\n\n    // ---\n    // PUBLIC METHODS.\n    // ---\n\n\n    // I determine if the preloader has started loading images yet.\n    isInitiated: function isInitiated() {\n      return( this.state !== this.states.PENDING );\n    },\n\n\n    // I determine if the preloader has failed to load all of the images.\n    isRejected: function isRejected() {\n      return( this.state === this.states.REJECTED );\n    },\n\n\n    // I determine if the preloader has successfully loaded all of the images.\n    isResolved: function isResolved() {\n      return( this.state === this.states.RESOLVED );\n    },\n\n\n    // I initiate the preload of the images. Returns a promise.\n    load: function load() {\n\n        // If the images are already loading, return the existing promise.\n        if ( this.isInitiated() ) {\n          return( this.promise );\n        }\n\n        this.state = this.states.LOADING;\n\n        for ( var i = 0 ; i < this.imageCount ; i++ ) {\n          this.loadImageLocation( this.imageLocations[ i ] );\n        }\n\n        // Return the deferred promise for the load event.\n        return( this.promise );\n\n    },\n\n\n    // ---\n    // PRIVATE METHODS.\n    // ---\n\n\n    // I handle the load-failure of the given image location.\n    handleImageError: function handleImageError( imageLocation ) {\n\n      this.errorCount++;\n\n      // If the preload action has already failed, ignore further action.\n      if ( this.isRejected() ) {\n        return;\n      }\n\n      this.state = this.states.REJECTED;\n\n      this.deferred.reject( imageLocation );\n\n    },\n\n\n    // I handle the load-success of the given image location.\n    handleImageLoad: function handleImageLoad( imageLocation ) {\n\n      this.loadCount++;\n\n      // If the preload action has already failed, ignore further action.\n      if ( this.isRejected() ) {\n        return;\n      }\n\n      // Notify the progress of the overall deferred. This is different\n      // than Resolving the deferred - you can call notify many times\n      // before the ultimate resolution (or rejection) of the deferred.\n      this.deferred.notify({\n        percent: Math.ceil( this.loadCount / this.imageCount * 100 ),\n        imageLocation: imageLocation\n      });\n\n      // If all of the images have loaded, we can resolve the deferred\n      // value that we returned to the calling context.\n      if ( this.loadCount === this.imageCount ) {\n\n        this.state = this.states.RESOLVED;\n\n        this.deferred.resolve( this.imageLocations );\n\n      }\n\n    },\n\n\n    // I load the given image location and then wire the load / error\n    // events back into the preloader instance.\n    // --\n    // NOTE: The load/error events trigger a $digest.\n    loadImageLocation: function loadImageLocation( imageLocation ) {\n\n      var preloader = this;\n\n      // When it comes to creating the image object, it is critical that\n      // we bind the event handlers BEFORE we actually set the image\n      // source. Failure to do so will prevent the events from proper\n      // triggering in some browsers.\n      var image = $( new Image() ).load(\n        function( event ) {\n\n          // Since the load event is asynchronous, we have to\n          // tell AngularJS that something changed.\n          $rootScope.$apply(function() {\n            preloader.handleImageLoad( event.target.src );\n\n            // Clean up object reference to help with the\n            // garbage collection in the closure.\n            preloader = image = event = null;\n\n          });\n\n        }\n      ).error(\n        function( event ) {\n\n          // Since the load event is asynchronous, we have to\n          // tell AngularJS that something changed.\n          $rootScope.$apply(function() {\n\n            preloader.handleImageError( event.target.src );\n\n            // Clean up object reference to help with the\n            // garbage collection in the closure.\n            preloader = image = event = null;\n\n          });\n\n        }\n      ).prop( \"src\", imageLocation );\n\n    }\n\n  };\n\n\n  // Return the factory instance.\n  return( Preloader );\n\n}]);","// Written by Joshua Comeau\n\nangular.module('pixelPlay')\n.factory('ReverseGeocoder', ['$q', '$interval', function($q, $interval) {\n  var pauseLength = 500,\n      geocoder    = new google.maps.Geocoder(),\n      currentLocation, latLng;\n\n\n  var getCityAndCountry = function(geoResults) {\n    var components = geoResults[0].address_components,\n        city = [], \n        country, lat, lng, latLng;\n\n    // In the Maps API, 'localities' are cities. Not all areas have one though.\n    // Localities will be 'unshifted' (pushed to the FRONT)\n    // All administrative_areas will be pushed (to the BACK)\n    // That way, we can just take the first member of the array to act as our city;\n\n    _.forEach(components, function(c) {\n      if ( c.types[0] === 'locality' )\n        city.unshift(c.long_name);\n      else if ( c.types[0].substr(0, 19) === 'administrative_area')\n        city.push(c.long_name);\n      else if ( c.types[0] === 'country' )\n        country = c.long_name;\n    });\n    return {\n      city:     city[0],\n      country:  country\n    };\n  };\n\n  return {\n    getLocation: function(photo_obj) {\n      var lat       = photo_obj.latitude,\n          lng       = photo_obj.longitude,\n          latLng    = new google.maps.LatLng(lat, lng),\n          deferred  = $q.defer();\n\n      geocoder.geocode({'latLng': latLng}, function(results, status) {\n        if (status == google.maps.GeocoderStatus.OK) {\n          if (results[1]) {\n            console.log(getCityAndCountry(results));\n            deferred.resolve({\n              location: getCityAndCountry(results)\n            });\n          } else {\n            alert('No results found');\n            deferred.reject({\n              location: null\n            });\n          }\n        } else {\n          alert('Geocoder failed due to: ' + status);\n          deferred.reject({\n            location: null\n          });\n        }\n      });\n\n      return deferred.promise;\n    }\n  };\n}]);"],"sourceRoot":"/source/"}